<!DOCTYPE html>
<html>
<head>
    <link rel = "stylesheet" href = "main_style.css">
    <style>
        * {
            box-sizing: border-box;
        }
        .column {
            float: left;
            width: 30%;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }
        .resizable-div {
            width: 50vw;
            height: 30vh;   
            display: flex;
            align-items: left;
            justify-content: left;
        }

        .resizable-text {
            font-size: 5vw; /* Text size adjusts with the div width */
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
</head>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
crossorigin=""></script>
<body class = "main" style="background-color:rgb(212, 76, 76);">
   
    
    <header>
        <a href="main.html">
            <img src="logo.png" alt="logo" style="width:50px;height:50px;">
        </a> 
      </header>
    
    <div class="row">
        <div class="column" style="background-color:#7c4c4c; padding: 1rem 1rem;">
            <div class="resizable-div">
                <p class="resizable-text">YOU ARE<br> AT RISK!</p>
            </div>
        </div>
        <div class="column">
            <!--<embed type="text/html" src="https://www.arcgis.com/apps/mapviewer/index.html?url=https://mapservices.weather.noaa.gov/eventdriven/rest/services/radar/radar_base_reflectivity/MapServer" width="500" height="650">-->
                <div id="map"></div>
                <script>
                    var map = L.map('map').setView([26.076772, -80.2390038], 10);
                    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                }).addTo(map);


                 //add National Weather Service Radar tiles
                 var radarLayer = L.tileLayer.wms("https://mapservices.weather.noaa.gov:443/eventdriven/services/radar/radar_base_reflectivity/MapServer/WmsServer?", {
                    layers: '1',
                    format: 'image/png',
                    transparent: true,
                    attribution: '&copy; <a href="https://www.weather.gov/copyright">NOAA</a>'
                }).addTo(map);

                </script>
        </div>

        <div class="column">
            <!--<embed type="text/html" src="https://www.arcgis.com/apps/mapviewer/index.html?url=https://mapservices.weather.noaa.gov/eventdriven/rest/services/radar/radar_base_reflectivity/MapServer" width="500" height="650">-->
                <div id="map2"></div>
                <script>
                      var map2 = L.map('map2').setView([26.076772, -80.2390038], 10);
                    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                }).addTo(map2);



                 //add National Weather Service Radar tiles
                var warningLayer = L.tileLayer.wms("https://mapservices.weather.noaa.gov:443/eventdriven/services/WWA/watch_warn_adv/MapServer/WMSServer?", {
                    layers: '1',
                    format: 'image/png',
                    transparent: true,
                    attribution: '&copy; <a href="https://www.weather.gov/copyright">NOAA</a>'
                }).addTo(map2);

                </script>
        </div>
    </div>
    <p class="resizable-text">We will send your information to local disaster relief orginizations... </p>



 


    <form onsubmit="getSelectedValue(event)">
        <label for="towns">Choose a city:</label>
        <select id="towns" name="towns">
            <option value="Tampa">Tampa</option>
            <option value="Melbourne">Melbourne</option>
            <option value="Keywest">Key West</option>
            <option value="Miami">Miami</option>
        </select>
        <br><br>
        <input type="submit" value="Submit">
    </form>

    
        
    <div class = alerts style="font-size: medium;">
        <table class="table">
            <thead>
                <tr>
                    <th><h2>Weather Alerts</h2></th>
                <tr>
            </thead>
        </table>
        <div id="alert"></div>
        
        <script>
         let selectedValue = "";

function getSelectedValue(event) {
    event.preventDefault();  // Prevent form submission
    const dropdown = document.getElementById("towns");  // Get the dropdown element
    selectedValue = dropdown.value;  // Get the selected value
    getLocation();  // Fetch weather alerts based on selected city
}

        

            getLocation()
            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(positionSuccess, positionError);
                } else {
                    document.getElementById('alert').innerText = "Geolocation not supported.";
                }
            }
    
            async function positionSuccess(position) {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                const alertUrl = `https://api.weather.gov/alerts/active?area=FL`;
    
                try {
                    const response = await fetch(alertUrl);
                    const alertData = await response.json(); 
    
                    if (alertData.features && alertData.features.length > 0) {
                        displayAlerts(alertData.features); 
                    } else {
                        document.getElementById('alert').innerText = 'No active alerts found.';
                    }
                } catch (error) {
                    document.getElementById('alert').innerText = 'Error retrieving alerts.';
                }
            }
    
            function positionError() {
                document.getElementById('alert').innerText = "Unable to retrieve location."; 
            }
    
            function displayAlerts(alerts) {
    const alertDiv = document.getElementById('alert');
    alertDiv.innerHTML = '';

    alerts.forEach(alert => {
        const properties = alert.properties;    
        const headline = properties.headline || 'No headline available';                                 
        const instruction = properties.instruction || 'No instructions provided';

        if (headline.toLowerCase().includes(selectedValue.toLowerCase())) {                    
            const alertItem = document.createElement('div');
            alertItem.innerHTML = `
                <h2>${headline}</h2>
                <p><strong>Instructions:</strong> ${instruction}</p>
            `;
            alertDiv.appendChild(alertItem); 
        }
    });
}
           
                
        </script>
    </div>

</body>
</html>
